### 智能大棚管理系统 概要设计说明书

#### 1. 概述
本系统旨在为农业温室大棚提供实时监测和自动化管理功能。系统基于嵌入式设计技术，以Arduino UNO微控制器为核心控制设备，并配合传感器实现环境参数的实时采集。同时，系统通过前端界面实现数据可视化与远程控制，用户可选择自动或手动模式对大棚环境进行管理。本系统设计简单，易操作，智能化程度高，能够大幅减少人力投入，提高管理效率。

#### 2. 系统功能
1. **数据监测与控制**：
   - 使用DHT11温湿度传感器、BMP180气压传感器、LDR光敏电阻等传感器采集环境数据（温度、湿度、气压和光照强度），并传输至服务器和数据库。
   - 支持自动控制模式，根据预设阈值自动启停风机、除湿器、照明设备和气泵。
   - 支持手动控制模式，用户可通过前端界面手动控制各设备。

2. **警报功能**：
   - 系统实时监测环境数据，当检测到数据超出安全阈值时，警报灯自动点亮，以提醒用户异常情况。

3. **数据存储与查询**：
   - 系统自动存储环境数据和设备状态数据，用户可以按时间查询历史数据。前端展示最近一小时、一天及两天的环境变化趋势，并通过折线图、柱状图等方式可视化数据。

4. **用户身份验证**：
   - 系统提供登录验证功能，确保数据安全性。未登录用户无法访问系统的控制与数据监测功能。

#### 3. 系统架构设计
系统主要分为数据监测模块、数据传输模块、控制模块、警报模块、数据库模块、服务器模块和前端模块。

1. **数据监测模块**：
   - 通过DHT11、BMP180和LDR等传感器采集温度、湿度、气压和光照强度。
   - 监测模块根据设定的时间间隔读取传感器数据并传输给服务器。

2. **数据传输模块**：
   - 数据传输模块包括硬件到服务器和服务器到硬件的双向数据传输。
   - 硬件到数据库的数据传输主要通过串口通信，将数据上传到服务器并存储在数据库中。
   - 服务器到硬件的传输用于接收前端用户的控制指令，并传递给硬件以执行相应的动作。

3. **控制模块**：
   - **自动控制模式**：系统根据传感器的数据自动判断并控制设备的启停。例如，温度超过预设值时，自动开启风机。
   - **手动控制模式**：用户可通过前端界面切换到手动模式，并发送控制指令，直接操作硬件设备的状态。

4. **警报模块**：
   - 通过警报灯模块，在检测到温度、湿度、气压或光照超出预设范围时，自动触发警报灯，以提示异常情况。

5. **数据库模块**：
   - 使用MySQL数据库存储环境数据和设备状态数据，支持数据的创建、更新、查询等操作。
   - 数据表设计：包括环境数据表和设备数据表，分别记录环境参数和设备的运行状态。
   - 支持按时间戳查询数据，提供指定时间段的历史数据供用户参考。

6. **服务器模块**：
   - 基于Flask框架，负责前端和硬件之间的通信。
   - 服务器接收前端的请求，进行数据库查询或数据更新，并传递至硬件端。
   - 服务器还支持用户登录状态的session维护，确保用户访问安全性。

7. **前端模块**：
   - 前端页面使用HTML、CSS、JavaScript及jQuery构建，支持用户登录、数据可视化展示、实时数据更新、手动设备控制等功能。
   - 前端具有自动刷新功能，页面每隔一定时间自动向服务器请求数据，以实现动态显示最新数据。

#### 4. 系统技术选型与工具
- **硬件与传感器**：
  - **主控芯片**：Arduino UNO
  - **传感器**：DHT11温湿度传感器、BMP180气压传感器、LDR光敏电阻
  - **其他设备**：风机、除湿器、气泵、照明设备等

- **开发平台与语言**：
  - **嵌入式开发**：Proteus 8.6用于仿真设计，FreeRTOS用于实时操作系统调度
  - **后端**：Flask框架（Python 3.8），pymysql库用于数据库操作
  - **前端**：HTML、CSS、JavaScript、jQuery和echarts.js用于数据可视化展示

- **数据库**：
  - 使用MySQL 8.0.15，提供数据存储、查询功能，并保证数据的持久化。

#### 5. 系统流程设计
1. **数据采集与存储**：
   - 硬件端周期性地从各传感器采集数据，数据按预设格式通过串口传输到服务器，服务器将数据解析并存入MySQL数据库。
   - 数据采集流程图如下：
     ```css
     [开始] → [传感器采集数据] → [格式化数据] → [通过串口传输] → [服务器解析并存储]
     ```

2. **自动与手动控制**：
   
   - 系统初始为自动模式，根据设定的阈值自动控制设备启停。用户可通过前端切换至手动模式，并发送控制指令，手动操作设备。
   - 控制流程图如下：
     ```css
     [自动模式] → [检查传感器数据] → [判断是否超出阈值] → [控制设备状态]
     [手动模式] → [接收前端指令] → [控制设备状态]
  ```
   
3. **数据查询与展示**：
   - 前端页面请求服务器获取不同时间段的数据，数据通过echarts.js渲染成折线图或柱状图，动态展示环境变化情况。
   - 数据查询流程图如下：
     ```css
     [用户请求数据] → [服务器查询数据库] → [返回查询数据] → [前端渲染图表]
     ```

#### 6. 总结
智能大棚管理系统通过嵌入式硬件设计与网络架构，实现了对大棚环境的实时监控、设备的智能化控制和数据的可视化展示。系统的实施提高了管理效率，减少了人工操作，降低了维护成本，具备较高的应用价值和实用性。